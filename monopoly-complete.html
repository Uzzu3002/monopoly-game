<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Monopoly Ultimate Banking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .welcome-screen h1 {
            font-size: 2.5rem;
            font-weight: bold;
            font-style: italic;
            text-decoration: underline;
            margin-bottom: 2rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Player Setup */
        .player-setup {
            display: none;
        }

        .player-count {
            margin: 30px 0;
            text-align: center;
        }

        .player-count h2 {
            margin-bottom: 20px;
        }

        .player-count-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .player-btn {
            background: #2a2a3e;
            color: white;
            border: 2px solid #667eea;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #764ba2;
        }

        .player-selection {
            margin: 30px 0;
        }

        .player-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .player-card {
            background: #2a2a3e;
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .player-card:hover {
            transform: scale(1.05);
        }

        .player-card.selected {
            border-color: #667eea;
            background: #3a3a4e;
        }

        .player-emoji {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Main Game Screen */
        .game-screen {
            display: none;
        }

        .game-header {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .player-balances {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .player-balance {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .player-balance h3 {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .command-menu {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .command-btn {
            background: #3a3a4e;
            color: white;
            border: 2px solid #667eea;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .command-btn:hover {
            background: #4a4a5e;
            transform: translateX(5px);
        }

        .command-number {
            display: inline-block;
            background: #667eea;
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 10px;
            font-weight: bold;
        }

        /* Modal/Scanner */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: #1a1a2e;
            margin: 50px auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: #e63946;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .scan-card {
            background: #2a2a3e;
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scan-card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .scan-card.property {
            border-left: 8px solid;
        }

        .property-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .property-name {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .property-rent {
            font-size: 0.8rem;
            color: #aaa;
        }

        .transaction-log {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            background: #1a1a2e;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            background: #2a2a3e;
            border: 2px solid #667eea;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }

        .property-info {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .property-item {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 10px;
            border-left: 6px solid;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .welcome-screen h1 {
                font-size: 1.8rem;
            }

            .command-grid {
                grid-template-columns: 1fr;
            }

            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="container">
            <h1>Welcome to Monopoly Ultimate Banking Game</h1>
            <button class="btn" onclick="startGame()">Start Game</button>
        </div>
    </div>

    <!-- Player Setup -->
    <div class="player-setup" id="playerSetup">
        <div class="container">
            <div class="player-count">
                <h2>Select Number of Players</h2>
                <div class="player-count-btns">
                    <button class="player-btn" onclick="selectPlayerCount(2)">2 Players</button>
                    <button class="player-btn" onclick="selectPlayerCount(3)">3 Players</button>
                    <button class="player-btn" onclick="selectPlayerCount(4)">4 Players</button>
                </div>
            </div>

            <div class="player-selection hidden" id="playerSelection">
                <h2>Select Your Players</h2>
                <div class="player-cards" id="playerCards"></div>
                <button class="btn" style="margin-top: 30px;" onclick="confirmPlayers()">Continue to Game</button>
            </div>
        </div>
    </div>

    <!-- Main Game Screen -->
    <div class="game-screen" id="gameScreen">
        <div class="container">
            <div class="game-header">
                <h1>ðŸŽ² Monopoly Ultimate Banking</h1>
                <div class="player-balances" id="playerBalances"></div>
            </div>

            <div class="command-menu">
                <h2>Game Commands</h2>
                <div class="command-grid">
                    <button class="command-btn" onclick="openCommand(1)">
                        <span class="command-number">1</span> Check Balance
                    </button>
                    <button class="command-btn" onclick="openCommand(2)">
                        <span class="command-number">2</span> Buy Property
                    </button>
                    <button class="command-btn" onclick="openCommand(3)">
                        <span class="command-number">3</span> Pay Rent
                    </button>
                    <button class="command-btn" onclick="openCommand(4)">
                        <span class="command-number">4</span> Sell Property
                    </button>
                    <button class="command-btn" onclick="openCommand(5)">
                        <span class="command-number">5</span> Pass GO
                    </button>
                    <button class="command-btn" onclick="openCommand(6)">
                        <span class="command-number">6</span> Show Properties
                    </button>
                    <button class="command-btn" onclick="openCommand(7)">
                        <span class="command-number">7</span> Swap Properties
                    </button>
                    <button class="command-btn" onclick="openCommand(8)">
                        <span class="command-number">8</span> Adjust Rent Level
                    </button>
                    <button class="command-btn" onclick="openCommand(9)">
                        <span class="command-number">9</span> Reset Game
                    </button>
                    <button class="command-btn" onclick="openCommand(10)">
                        <span class="command-number">10</span> Other Transaction
                    </button>
                </div>
            </div>

            <div class="transaction-log">
                <h3>Transaction History</h3>
                <div id="transactionLog"></div>
            </div>
        </div>
    </div>

    <!-- Modal for Card Scanning -->
    <div class="modal" id="scanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Scan Card</h2>
                <button class="close-modal" onclick="closeModal()">Close</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
// Game Data
const PLAYERS = [
  { id: 1, name: "Red Car", emoji: "ðŸš—", color: "#e63946" },
  { id: 2, name: "Blue Boat", emoji: "â›µ", color: "#1d3557" },
  { id: 3, name: "White Jet", emoji: "âœˆï¸", color: "#f1faee" },
  { id: 4, name: "Green Helicopter", emoji: "ðŸš", color: "#2a9d8f" }
];

const PROPERTIES = [
  { id: 1, name: "Shillong", number: 1, color: "brown", rents: [70, 130, 220, 370, 750], price: 375 },
  { id: 2, name: "Bhubaneswar", number: 2, color: "brown", rents: [70, 130, 220, 370, 750], price: 375 },
  { id: 3, name: "Ranchi", number: 3, color: "lightblue", rents: [80, 140, 240, 410, 800], price: 400 },
  { id: 4, name: "Srinagar", number: 4, color: "lightblue", rents: [80, 140, 240, 410, 800], price: 400 },
  { id: 5, name: "Shimla", number: 5, color: "lightblue", rents: [100, 160, 260, 440, 860], price: 430 },
  { id: 6, name: "Patna", number: 6, color: "pink", rents: [110, 180, 290, 460, 900], price: 450 },
  { id: 7, name: "Panaji", number: 7, color: "pink", rents: [110, 180, 290, 460, 900], price: 450 },
  { id: 8, name: "Haridwar", number: 8, color: "pink", rents: [130, 200, 310, 490, 980], price: 490 },
  { id: 9, name: "Guwahati", number: 9, color: "orange", rents: [140, 210, 330, 520, 1000], price: 500 },
  { id: 10, name: "Jaipur", number: 10, color: "orange", rents: [140, 210, 330, 520, 1000], price: 500 },
  { id: 11, name: "Bhopal", number: 11, color: "orange", rents: [160, 230, 350, 550, 1100], price: 550 },
  { id: 12, name: "Chandigarh", number: 12, color: "red", rents: [170, 250, 380, 580, 1160], price: 580 },
  { id: 13, name: "Kochi", number: 13, color: "red", rents: [170, 250, 380, 580, 1160], price: 580 },
  { id: 14, name: "Ahmedabad", number: 14, color: "red", rents: [190, 270, 400, 610, 1200], price: 600 },
  { id: 15, name: "Lucknow", number: 15, color: "yellow", rents: [200, 280, 420, 640, 1300], price: 650 },
  { id: 16, name: "Gurugram", number: 16, color: "yellow", rents: [200, 280, 420, 640, 1300], price: 650 },
  { id: 17, name: "Hyderabad", number: 17, color: "yellow", rents: [220, 300, 440, 670, 1340], price: 670 },
  { id: 18, name: "Kolkata", number: 18, color: "green", rents: [230, 320, 460, 700, 1400], price: 700 },
  { id: 19, name: "Chennai", number: 19, color: "green", rents: [230, 320, 460, 700, 1400], price: 700 },
  { id: 20, name: "Delhi", number: 20, color: "green", rents: [250, 340, 480, 730, 1440], price: 720 },
  { id: 21, name: "Bengaluru", number: 21, color: "blue", rents: [270, 360, 510, 740, 1500], price: 750 },
  { id: 22, name: "Mumbai", number: 22, color: "blue", rents: [300, 400, 560, 810, 1600], price: 800 }
];

const GAME_RULES = {
  startingBalance: 1500,
  passGoBonus: 200,
  sellMultiplier: 0.5
};

// Game State
let gameState = {
    players: [],
    properties: {},
    selectedPlayers: [],
    currentCommand: null,
    transactionLog: []
};

// Initialize game state
function initializeGame() {
    PROPERTIES.forEach(prop => {
        gameState.properties[prop.id] = {
            ...prop,
            owner: null,
            rentLevel: 1
        };
    });
}

// Start game - show player setup
function startGame() {
    document.getElementById('welcomeScreen').style.display = 'none';
    document.getElementById('playerSetup').style.display = 'block';
}

// Select player count
function selectPlayerCount(count) {
    document.querySelectorAll('.player-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.target.classList.add('selected');
    
    showPlayerSelection(count);
}

function showPlayerSelection(count) {
    const container = document.getElementById('playerCards');
    container.innerHTML = '';
    
    PLAYERS.forEach((player, index) => {
        const card = document.createElement('div');
        card.className = 'player-card';
        card.innerHTML = `
            <div class="player-emoji">${player.emoji}</div>
            <div>${player.name}</div>
        `;
        card.onclick = () => togglePlayer(player, card, count);
        container.appendChild(card);
    });
    
    document.getElementById('playerSelection').classList.remove('hidden');
}

function togglePlayer(player, card, maxCount) {
    const index = gameState.selectedPlayers.findIndex(p => p.id === player.id);
    
    if (index > -1) {
        gameState.selectedPlayers.splice(index, 1);
        card.classList.remove('selected');
    } else {
        if (gameState.selectedPlayers.length < maxCount) {
            gameState.selectedPlayers.push(player);
            card.classList.add('selected');
        } else {
            alert(`You can only select ${maxCount} players`);
        }
    }
}

// Confirm players and start game
function confirmPlayers() {
    if (gameState.selectedPlayers.length < 2) {
        alert('Please select at least 2 players');
        return;
    }
    
    // Initialize players with starting balance
    gameState.players = gameState.selectedPlayers.map(p => ({
        ...p,
        balance: GAME_RULES.startingBalance
    }));
    
    initializeGame();
    showGameScreen();
}

function showGameScreen() {
    document.getElementById('playerSetup').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    updatePlayerBalances();
}

function updatePlayerBalances() {
    const container = document.getElementById('playerBalances');
    container.innerHTML = '';
    
    gameState.players.forEach(player => {
        const balanceCard = document.createElement('div');
        balanceCard.className = 'player-balance';
        balanceCard.style.borderLeftColor = player.color;
        balanceCard.innerHTML = `
            <h3>${player.emoji} ${player.name}</h3>
            <div class="balance-amount">$${player.balance.toLocaleString()}</div>
        `;
        container.appendChild(balanceCard);
    });
}

// Command handlers
function openCommand(commandNum) {
    gameState.currentCommand = commandNum;
    
    switch(commandNum) {
        case 1: checkBalance(); break;
        case 2: buyProperty(); break;
        case 3: payRent(); break;
        case 4: sellProperty(); break;
        case 5: passGO(); break;
        case 6: showProperties(); break;
        case 7: swapProperties(); break;
        case 8: adjustRentLevel(); break;
        case 9: resetGame(); break;
        case 10: otherTransaction(); break;
    }
}

// 1. Check Balance
function checkBalance() {
    showModal('Check Balance', 'Select a player to check balance');
    showPlayerScanner((player) => {
        alert(`${player.name} ${player.emoji}\nBalance: $${player.balance.toLocaleString()}`);
        closeModal();
    });
}

// 2. Buy Property
function buyProperty() {
    showModal('Buy Property', 'Select property to buy');
    showPropertyScanner((property) => {
        if (property.owner !== null) {
            alert('This property is already owned!');
            return;
        }
        
        showModal('Buy Property', 'Select player who is buying');
        showPlayerScanner((player) => {
            if (player.balance < property.price) {
                alert('Insufficient funds!');
                return;
            }
            
            // Deduct price
            const playerIndex = gameState.players.findIndex(p => p.id === player.id);
            gameState.players[playerIndex].balance -= property.price;
            
            // Assign ownership
            gameState.properties[property.id].owner = player.id;
            
            logTransaction(`${player.name} bought ${property.name} for $${property.price}`);
            updatePlayerBalances();
            closeModal();
        });
    });
}

// 3. Pay Rent
function payRent() {
    showModal('Pay Rent', 'Select property to pay rent for');
    showPropertyScanner((property) => {
        if (property.owner === null) {
            alert('This property has no owner!');
            return;
        }
        
        showModal('Pay Rent', 'Select player who is paying rent');
        showPlayerScanner((payer) => {
            const currentRent = property.rents[property.rentLevel - 1];
            const owner = gameState.players.find(p => p.id === property.owner);
            
            if (payer.id === property.owner) {
                // Landed on own property - increase rent level
                if (property.rentLevel < 5) {
                    gameState.properties[property.id].rentLevel++;
                    logTransaction(`${payer.name} landed on own property ${property.name}. Rent level increased to ${property.rentLevel}`);
                }
            } else {
                // Pay rent to owner
                if (payer.balance < currentRent) {
                    alert('Insufficient funds! Player is bankrupt.');
                    handleBankruptcy(payer.id);
                    return;
                }
                
                const payerIndex = gameState.players.findIndex(p => p.id === payer.id);
                const ownerIndex = gameState.players.findIndex(p => p.id === owner.id);
                
                gameState.players[payerIndex].balance -= currentRent;
                gameState.players[ownerIndex].balance += currentRent;
                
                // Increase rent level after payment
                if (property.rentLevel < 5) {
                    gameState.properties[property.id].rentLevel++;
                }
                
                logTransaction(`${payer.name} paid $${currentRent} rent to ${owner.name} for ${property.name}. Rent level increased to ${property.rentLevel}`);
            }
            
            updatePlayerBalances();
            closeModal();
        });
    });
}

// 4. Sell Property
function sellProperty() {
    showModal('Sell Property', 'Select property to sell');
    showPropertyScanner((property) => {
        if (property.owner === null) {
            alert('This property has no owner!');
            return;
        }
        
        const sellPrice = Math.floor(property.price * GAME_RULES.sellMultiplier);
        const owner = gameState.players.find(p => p.id === property.owner);
        
        if (confirm(`Sell ${property.name} for $${sellPrice}?`)) {
            const ownerIndex = gameState.players.findIndex(p => p.id === property.owner);
            gameState.players[ownerIndex].balance += sellPrice;
            gameState.properties[property.id].owner = null;
            gameState.properties[property.id].rentLevel = 1;
            
            logTransaction(`${owner.name} sold ${property.name} for $${sellPrice}`);
            updatePlayerBalances();
            closeModal();
        }
    });
}

// 5. Pass GO
function passGO() {
    showModal('Pass GO', 'Select player who passed GO');
    showPlayerScanner((player) => {
        const playerIndex = gameState.players.findIndex(p => p.id === player.id);
        gameState.players[playerIndex].balance += GAME_RULES.passGoBonus;
        
        logTransaction(`${player.name} passed GO and collected $${GAME_RULES.passGoBonus}`);
        updatePlayerBalances();
        closeModal();
    });
}

// 6. Show Properties
function showProperties() {
    showModal('All Properties', '');
    
    let html = '<div class="property-grid">';
    
    PROPERTIES.forEach(prop => {
        const state = gameState.properties[prop.id];
        const owner = state.owner ? gameState.players.find(p => p.id === state.owner) : null;
        const currentRent = prop.rents[state.rentLevel - 1];
        
        html += `
            <div class="property-item" style="border-left-color: ${getColorCode(prop.color)}">
                <strong>#${prop.number} ${prop.name}</strong><br>
                <small>Price: $${prop.price}</small><br>
                <small>Current Rent: $${currentRent} (Level ${state.rentLevel})</small><br>
                ${owner ? `<small>Owner: ${owner.emoji} ${owner.name}</small>` : '<small style="color: #888">Unowned</small>'}
            </div>
        `;
    });
    
    html += '</div>';
    document.getElementById('modalBody').innerHTML += html;
}

// 7. Swap Properties - FULLY WORKING VERSION
function swapProperties() {
    // First check if there are any owned properties
    const ownedProperties = Object.values(gameState.properties).filter(p => p.owner !== null);
    
    if (ownedProperties.length < 2) {
        alert('You need at least 2 owned properties to swap!\n\nBuy some properties first, then come back to swap.');
        return;
    }
    
    let firstProperty = null;
    let firstOwner = null;
    
    showModal('Swap Properties - Step 1', 'Select FIRST property to swap (must be owned)');
    showPropertyScanner((property1) => {
        if (!property1.owner) {
            alert('This property has no owner! Please select an owned property.');
            return;
        }
        
        firstProperty = property1;
        firstOwner = gameState.players.find(p => p.id === property1.owner);
        
        showModal('Swap Properties - Step 2', `<strong>First property selected:</strong><br>${property1.name} (owned by ${firstOwner.emoji} ${firstOwner.name})<br><br>Now select SECOND property to swap`);
        showPropertyScanner((property2) => {
            if (!property2.owner) {
                alert('This property has no owner! Please select an owned property.');
                return;
            }
            
            if (property1.id === property2.id) {
                alert('Cannot swap a property with itself! Please select a different property.');
                return;
            }
            
            const secondOwner = gameState.players.find(p => p.id === property2.owner);
            
            // Confirm swap
            if (confirm(`Swap these properties?\n\n${firstOwner.emoji} ${firstOwner.name}: ${property1.name}\n     â†•ï¸\n${secondOwner.emoji} ${secondOwner.name}: ${property2.name}\n\nClick OK to confirm swap.`)) {
                // Swap ownership
                const temp = gameState.properties[property1.id].owner;
                gameState.properties[property1.id].owner = gameState.properties[property2.id].owner;
                gameState.properties[property2.id].owner = temp;
                
                logTransaction(`${firstOwner.name} and ${secondOwner.name} swapped properties: ${property1.name} â†”ï¸ ${property2.name}`);
                alert('âœ… Properties swapped successfully!\n\nâš ï¸ Remember to exchange the physical cards too!');
                closeModal();
            } else {
                closeModal();
            }
        });
    });
}

// 8. Adjust Rent Level
function adjustRentLevel() {
    showModal('Adjust Rent Level', 'Select property to adjust');
    showPropertyScanner((property) => {
        const newLevel = prompt(`Current rent level: ${property.rentLevel}\nEnter new level (1-5):`, property.rentLevel);
        
        if (newLevel && newLevel >= 1 && newLevel <= 5) {
            gameState.properties[property.id].rentLevel = parseInt(newLevel);
            logTransaction(`Rent level for ${property.name} adjusted to ${newLevel}`);
            closeModal();
        }
    });
}

// 9. Reset Game
function resetGame() {
    if (confirm('Are you sure you want to reset the game? All progress will be lost.')) {
        location.reload();
    }
}

// 10. Other Transaction
function otherTransaction() {
    showModal('Other Transaction', `
        <div class="input-group">
            <label>Transaction Type:</label>
            <select id="transactionType">
                <option value="player_to_player">Player to Player</option>
                <option value="bank_to_player">Bank to Player (Credit)</option>
                <option value="player_to_bank">Player to Bank (Debit)</option>
            </select>
        </div>
        <div class="input-group">
            <label>Amount:</label>
            <input type="number" id="transactionAmount" placeholder="Enter amount">
        </div>
        <button class="btn" onclick="executeTransaction()">Execute</button>
    `);
}

function executeTransaction() {
    const type = document.getElementById('transactionType').value;
    const amount = parseInt(document.getElementById('transactionAmount').value);
    
    if (!amount || amount <= 0) {
        alert('Please enter a valid amount');
        return;
    }
    
    if (type === 'player_to_player') {
        showModal('Select Sender', '');
        showPlayerScanner((sender) => {
            showModal('Select Receiver', '');
            showPlayerScanner((receiver) => {
                if (sender.balance < amount) {
                    alert('Insufficient funds!');
                    return;
                }
                
                const senderIndex = gameState.players.findIndex(p => p.id === sender.id);
                const receiverIndex = gameState.players.findIndex(p => p.id === receiver.id);
                
                gameState.players[senderIndex].balance -= amount;
                gameState.players[receiverIndex].balance += amount;
                
                logTransaction(`${sender.name} paid $${amount} to ${receiver.name}`);
                updatePlayerBalances();
                closeModal();
            });
        });
    } else if (type === 'bank_to_player') {
        showModal('Select Player', '');
        showPlayerScanner((player) => {
            const playerIndex = gameState.players.findIndex(p => p.id === player.id);
            gameState.players[playerIndex].balance += amount;
            
            logTransaction(`${player.name} received $${amount} from Bank`);
            updatePlayerBalances();
            closeModal();
        });
    } else if (type === 'player_to_bank') {
        showModal('Select Player', '');
        showPlayerScanner((player) => {
            if (player.balance < amount) {
                alert('Insufficient funds!');
                return;
            }
            
            const playerIndex = gameState.players.findIndex(p => p.id === player.id);
            gameState.players[playerIndex].balance -= amount;
            
            logTransaction(`${player.name} paid $${amount} to Bank`);
            updatePlayerBalances();
            closeModal();
        });
    }
}

// Helper functions
function showModal(title, content) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = content;
    document.getElementById('scanModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('scanModal').style.display = 'none';
}

function showPlayerScanner(callback) {
    let html = '<h3>Tap a player card:</h3><div class="card-grid">';
    
    gameState.players.forEach(player => {
        html += `
            <div class="scan-card" onclick='handlePlayerSelection(${JSON.stringify(player).replace(/'/g, "&#39;")})'>
                <div style="font-size: 3rem">${player.emoji}</div>
                <div>${player.name}</div>
                <div style="font-size: 0.9rem; color: #aaa">$${player.balance.toLocaleString()}</div>
            </div>
        `;
    });
    
    html += '</div>';
    document.getElementById('modalBody').innerHTML = html;
    
    window.currentPlayerCallback = callback;
}

function handlePlayerSelection(player) {
    if (window.currentPlayerCallback) {
        window.currentPlayerCallback(player);
    }
}

function showPropertyScanner(callback) {
    let html = '<h3>Tap a property card:</h3><div class="card-grid">';
    
    PROPERTIES.forEach(prop => {
        const state = gameState.properties[prop.id];
        const owner = state.owner ? gameState.players.find(p => p.id === state.owner) : null;
        const isOwned = owner !== null;
        
        html += `
            <div class="scan-card property" style="border-left-color: ${getColorCode(prop.color)}; ${!isOwned ? 'opacity: 0.5;' : ''}" onclick='handlePropertySelection(${JSON.stringify(state).replace(/'/g, "&#39;")})'>
                <div class="property-number">#${prop.number}</div>
                <div class="property-name">${prop.name}</div>
                <div class="property-rent">Level ${state.rentLevel}: $${prop.rents[state.rentLevel - 1]}</div>
                ${owner ? `<div style="font-size: 0.8rem; margin-top: 5px; color: #4CAF50;">âœ“ ${owner.emoji} ${owner.name}</div>` : '<div style="font-size: 0.8rem; margin-top: 5px; color: #888;">Unowned</div>'}
            </div>
        `;
    });
    
    html += '</div>';
    document.getElementById('modalBody').innerHTML = html;
    
    window.currentPropertyCallback = callback;
}

function handlePropertySelection(property) {
    if (window.currentPropertyCallback) {
        window.currentPropertyCallback(property);
    }
}

function getColorCode(color) {
    const colors = {
        brown: '#8B4513',
        lightblue: '#87CEEB',
        pink: '#FF1493',
        orange: '#FF8C00',
        red: '#DC143C',
        yellow: '#FFD700',
        green: '#228B22',
        blue: '#0000CD'
    };
    return colors[color] || '#667eea';
}

function logTransaction(message) {
    const timestamp = new Date().toLocaleTimeString();
    gameState.transactionLog.unshift({ time: timestamp, message });
    
    if (gameState.transactionLog.length > 20) {
        gameState.transactionLog.pop();
    }
    
    updateTransactionLog();
}

function updateTransactionLog() {
    const container = document.getElementById('transactionLog');
    container.innerHTML = '';
    
    gameState.transactionLog.forEach(log => {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `<small>${log.time}</small><br>${log.message}`;
        container.appendChild(entry);
    });
}

function handleBankruptcy(playerId) {
    const player = gameState.players.find(p => p.id === playerId);
    
    Object.keys(gameState.properties).forEach(propId => {
        if (gameState.properties[propId].owner === playerId) {
            gameState.properties[propId].owner = null;
            gameState.properties[propId].rentLevel = 1;
        }
    });
    
    gameState.players = gameState.players.filter(p => p.id !== playerId);
    
    logTransaction(`${player.name} went bankrupt! All properties returned to bank.`);
    updatePlayerBalances();
    
    if (gameState.players.length === 1) {
        alert(`ðŸŽ‰ ${gameState.players[0].name} WINS! ðŸŽ‰`);
    }
}
    </script>
</body>
</html>
